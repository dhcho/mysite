<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="board">
	<insert id="insert" parameterType="boardvo">
		<![CDATA[
		insert
				   into board(title, contents, reg_date, hit, group_no, order_no, depth, user_no)
				 values (#{title }, #{contents }, now(), 0, 0, 0, 0, #{userNo })
	  	]]>
	  	<selectKey keyProperty="no" resultType="long" order="AFTER">
			<![CDATA[
		  	select last_insert_id()
	  		]]>
	  	</selectKey>	
	</insert>

	<select id="findAll" resultType="boardvo">
		<![CDATA[	
		  select a.no, a.title, a.depth, a.hit, b.no as userNo, b.name, a.reg_date
					     from board a, user b
						 where a.user_no = b.no
					 order by a.no desc
	  	]]>	
	</select>
	
	<select id="findCnt" resultType="int">
		<![CDATA[	
		  select count(*) from board
	  	]]>	
	</select>
	
	<select id="findPage" resultType="boardvo">
		  select a.no, a.title, a.depth, a.hit, b.no as userNo, b.name as userName, a.reg_date as regDate
					     from board a, user b
						 where a.user_no = b.no
						 <if test="kwd != null and kwd != '' ">
						   and a.title like #{kwd }
						 </if>
					 order by a.no desc
					 limit #{startPage }, #{onePageCnt }
	</select>
	
	<select id="findByNo" parameterType="long" resultType="boardvo">
		<![CDATA[
		select no, title, contents, depth, hit, reg_date
					     from board
						 where no = #{no }
		]]>
	</select>
	
	<update id="update" parameterType="boardvo">
				update board
				   set title = #{title }, contents = #{contents }
				 where no = #{no }
	</update>
	
	<update id="updateHit" parameterType="int">
				<![CDATA[
				update board
				   set hit = hit + 1
				 where no = #{no }
				]]>
	</update>
	
	<delete id="delete" parameterType="boardvo">
		<![CDATA[
		delete
				   from board
				 where no = #{no } and user_no = #{userNo }
	  	]]>	
	</delete>
</mapper>